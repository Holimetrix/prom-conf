global:                                                                         
  scrape_interval:     15s
  evaluation_interval: 15s
  external_labels:                                                              
      monitor: 'exporter-metrics'                                                
                                                                                
rule_files:                                                                     
                                                                                
scrape_configs:                                                                 
  - job_name: 'hosts'                                                           
                                                                                
    target_groups:                                                          
    - targets:{{range $hosts := ls "/hosts"}} {{$host := printf "/hosts/%s/agent_ip" $hosts}}  {{if exists $host}}              
        - '{{getv $host}}:9104'                                                 
        - '{{getv $host}}:9100'{{end}}{{end}}
    
  - job_name: 'rancher-api'

    target_groups:
      - targets:
          - 'rancher-api-integration:9010'
